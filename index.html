<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ฟอร์มพนักงาน</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body {
    background-color: #f0f2f5;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  h2 {
    margin-bottom: 30px;
    font-weight: 600;
    color: #343a40;
  }
  .employee-card {
    background: #ffffff;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    padding: 20px;
    margin-bottom: 20px;
    transition: transform 0.2s ease;
  }
  .employee-card:hover {
    transform: translateY(-2px);
  }
  .form-label {
    font-weight: 500;
    color: #495057;
  }
  .btn-submit {
    width: 100%;
    padding: 10px;
  }
</style>
</head>
<body class="p-3">

<div class="container">
  <h2>ฟอร์มพนักงาน</h2>

  <div class="mb-4">
    <label for="company" class="form-label">เลือกบริษัท</label>
    <select id="company" class="form-select" onchange="loadEmployees()">
      <option value="">-- เลือกบริษัท --</option>
      <option value="A">บริษัท A</option>
      <option value="B">บริษัท B</option>
    </select>
  </div>

  <form id="employeeForm"></form>
</div>

<script>
const employeeData = {
  "A": ["นาย A", "นาย B", "นาย C", "นาย D"],
  "B": ["นาย X", "นาย Y", "นาย Z"]
};

function loadEmployees() {
  const company = document.getElementById('company').value;
  const container = document.getElementById('employeeForm');
  container.innerHTML = '';

  if(company && employeeData[company]){
    employeeData[company].forEach(name => {
      const card = document.createElement('div');
      card.className = 'employee-card row g-3 align-items-center';

      card.innerHTML = `
        <div class="col-12 col-md-4">
          <label class="form-label">${name}</label>
        </div>
        <div class="col-6 col-md-4">
          <select class="form-select" name="status_${name}">
            <option value="ไปได้">ไปได้</option>
            <option value="ไม่ได้">ไม่ได้</option>
          </select>
        </div>
        <div class="col-6 col-md-4">
          <input type="text" class="form-control" name="replacement_${name}" placeholder="ระบุคนแทน">
        </div>
      `;
      container.appendChild(card);
    });

    const submitBtn = document.createElement('button');
    submitBtn.type = 'button';
    submitBtn.className = 'btn btn-primary mt-3 btn-submit';
    submitBtn.innerText = 'ส่งข้อมูล';
    submitBtn.onclick = submitForm;
    container.appendChild(submitBtn);
  }
}


function submitForm() {
  const data = {};
  document.querySelectorAll('#employeeForm select, #employeeForm input').forEach(el=>{
    data[el.name] = el.value;
  });

  fetch("https://defaultad8c1baa41294a92b0a4b19a1fa329.b9.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/37559b7307f84285a2d828be210714df/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=HFpFTuAZFQrboNOSBU1i6mH17zbh6Vd5_QzMxhY5bBM", {
    method: "POST",
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  }).then(res => alert("ส่งข้อมูลเรียบร้อย"))
    .catch(err => alert("เกิดข้อผิดพลาด"));
}
</script>
</body>
</html>
